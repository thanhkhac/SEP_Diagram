@startuml
actor User
participant "Edit Class UI" as UI
participant ClassEndpoints
participant UpdateClassCommandHandler as Handler
participant ClassService
participant ApplicationDbContext
participant Database

User -> UI : Edit info, click "Save"
activate UI
UI -> ClassEndpoints : PATCH /api/Class/{ClassId}
activate ClassEndpoints
ClassEndpoints -> Handler : Handle(UpdateClassCommand)
activate Handler
Handler -> ClassService : GetClassOwnerAccess(classId)
activate ClassService
ClassService -> ApplicationDbContext : Query Class and ClassUser
activate ApplicationDbContext
ApplicationDbContext -> Database : Query Class and ClassUser
activate Database
Database --> ApplicationDbContext : Class, ClassUser
deactivate Database
ApplicationDbContext --> ClassService : Class, ClassUser
deactivate ApplicationDbContext
ClassService --> Handler : (IsOwner, ClassExists)
deactivate ClassService
alt Class Not Found
    Handler --> ClassEndpoints : Error: CLASS_NOTFOUND
    ClassEndpoints --> UI : 400 Bad Request (errorCode: CLASS_NOTFOUND)
    UI -> User : Error: Class not found
else Not Class Owner
    Handler --> ClassEndpoints : Error: ONLY_OWNERS_CAN_UPDATE
    ClassEndpoints --> UI : 400 Bad Request (errorCode: ONLY_OWNERS_CAN_UPDATE)
    UI -> User : Error: Only owners can update
else Class Found and Is Owner
    Handler -> ApplicationDbContext : Update Class
    activate ApplicationDbContext
    ApplicationDbContext -> Database : Update Class
    activate Database
    Database --> ApplicationDbContext : Success
    deactivate Database
    ApplicationDbContext --> Handler : Guid
    deactivate ApplicationDbContext
    Handler --> ClassEndpoints : Guid
    ClassEndpoints --> UI : 200 OK (ApiResponse<Guid>)
    UI -> User : Info: Update successful
end
deactivate Handler
deactivate ClassEndpoints
deactivate UI
@enduml