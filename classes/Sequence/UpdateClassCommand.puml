@startuml
actor "Lecturer" as User
participant "Edit Class UI" as UI <<UI>>
participant ":ClassEndpoints" as ClassEndpoints <<Controller>>
participant ":UpdateClassCommandHandler" as UpdateClassCommandHandler <<Handler>>
participant ":ClassService" as ClassService <<Service>>
participant ":ApplicationDbContext" as ApplicationDbContext <<DbContext>>
participant Database

note right of UpdateClassCommandHandler
  Managed by MediatR
end note

note right of ClassService
  Managed by IoC
end note

note right of ApplicationDbContext
  Managed by IoC
end note

User -> UI : Edit info, click "Save"
activate UI
UI -> ClassEndpoints : PATCH /api/Class/{ClassId}
activate ClassEndpoints
ClassEndpoints -> UpdateClassCommandHandler : Handle(UpdateClassCommand)
deactivate ClassEndpoints
activate UpdateClassCommandHandler
UpdateClassCommandHandler -> ClassService : GetClassOwnerAccess(classId)
deactivate UpdateClassCommandHandler
activate ClassService
ClassService -> ApplicationDbContext : Query Class and ClassUser
deactivate ClassService
activate ApplicationDbContext
ApplicationDbContext -> Database : Query Class and ClassUser
deactivate ApplicationDbContext
activate Database
Database --> ApplicationDbContext : Class, ClassUser
deactivate Database
activate ApplicationDbContext
ApplicationDbContext --> ClassService : Class, ClassUser
deactivate ApplicationDbContext
activate ClassService
ClassService --> UpdateClassCommandHandler : (IsOwner, ClassExists)
deactivate ClassService
activate UpdateClassCommandHandler
alt Class Not Found
    UpdateClassCommandHandler -> ClassEndpoints : Error: CLASS_NOTFOUND
    deactivate UpdateClassCommandHandler
    activate ClassEndpoints
    ClassEndpoints --> UI : 400 Bad Request { "error": "CLASS_NOTFOUND" }
    deactivate ClassEndpoints
    UI -> User : Display error: Class not found
else Not Class Owner
    activate UpdateClassCommandHandler
    UpdateClassCommandHandler -> ClassEndpoints : Error: ONLY_OWNERS_CAN_UPDATE
    deactivate UpdateClassCommandHandler
    activate ClassEndpoints
    ClassEndpoints --> UI : 400 Bad Request { "error": "ONLY_OWNERS_CAN_UPDATE" }
    deactivate ClassEndpoints
    UI -> User : Display error: Only owners can update
else Class Found and Is Owner
    activate UpdateClassCommandHandler
    UpdateClassCommandHandler -> ApplicationDbContext : Update Class
    deactivate UpdateClassCommandHandler
    activate ApplicationDbContext
    ApplicationDbContext -> Database : Update Class
    deactivate ApplicationDbContext
    activate Database
    Database --> ApplicationDbContext : Success
    deactivate Database
    activate ApplicationDbContext
    ApplicationDbContext --> UpdateClassCommandHandler : Guid
    deactivate ApplicationDbContext
    activate UpdateClassCommandHandler
    UpdateClassCommandHandler -> ClassEndpoints : Guid
    deactivate UpdateClassCommandHandler
    activate ClassEndpoints
    ClassEndpoints --> UI : 200 OK (ApiResponse<Guid>)
    deactivate ClassEndpoints
    UI -> User : Display info: Update successful
end
deactivate UI

@enduml