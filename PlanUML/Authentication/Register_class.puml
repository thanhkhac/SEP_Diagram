@startuml
interface IRequest<T>
interface IRequestHandler<C, R>
interface IIdentityService
interface IUserManager
interface IApplicationDbContext
interface IUser

class UI

class AuthEndpoint {
    +Register(command: RegisterUserCommand): Result
}

class RegisterUserHandler {
    -_context: IApplicationDbContext
    -_user: IUser
    -_identityService: IIdentityService
    +Handle(command: RegisterUserCommand): Result
}
RegisterUserHandler ..|> IRequestHandler

class RegisterUserCommand {
    +Email: string
    +Password: string
    +FullName: string
}
RegisterUserCommand ..|> IRequest

class IdentityService {
    +CreateUserAsync(email: string, password: string): Result
}
IdentityService ..|> IIdentityService

class UserManager {
    +FindByEmailAsync(email: string): User
    +CreateAsync(user: User, password: string): Result
}
UserManager ..|> IUserManager

class User {
    +Id: Guid
    +Email: string
    +FullName: string
    +PasswordHash: string
    +IsDeleted: bool
    +IsBanned: bool
    +TokenCount: long
    +Balance: long
}

class Result {
    +Success: bool
    +Errors: Dictionary<string, string[]>
}

class ApplicationDbContext
ApplicationDbContext ..|> IApplicationDbContext

class CurrentUser
CurrentUser ..|> IUser

UI --> AuthEndpoint
AuthEndpoint --> RegisterUserHandler
RegisterUserHandler --> RegisterUserCommand
RegisterUserHandler --> IIdentityService
RegisterUserHandler --> IApplicationDbContext
RegisterUserHandler --> IUser
IdentityService --> UserManager
UserManager --> User
ApplicationDbContext --> User
@enduml