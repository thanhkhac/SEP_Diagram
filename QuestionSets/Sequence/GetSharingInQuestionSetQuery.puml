@startuml
actor User
participant "Question Set Detail UI" as UI
participant QuestionSetEndpoints
participant GetSharingInQuestionSetQueryHandler as Handler
participant QuestionSetService
participant ApplicationDbContext
participant Database

User -> UI : View sharing details
activate UI
UI -> QuestionSetEndpoints : GET /api/QuestionSet/{questionSetId}/Sharing
activate QuestionSetEndpoints
QuestionSetEndpoints -> Handler : Handle(GetSharingInQuestionSetQuery)
activate Handler
Handler -> ApplicationDbContext : Query QuestionSet by QuestionSetId
activate ApplicationDbContext
ApplicationDbContext -> Database : Query QuestionSet
activate Database
Database --> ApplicationDbContext : QuestionSet
deactivate Database
ApplicationDbContext --> Handler : QuestionSet
deactivate ApplicationDbContext
alt Question Set Not Found
    Handler --> QuestionSetEndpoints : Error: QUESTION_SET_NOT_FOUND
    QuestionSetEndpoints --> UI : 400 Bad Request (errorCode: QUESTION_SET_NOT_FOUND)
    UI -> User : Error: Question set not found
else Question Set Found
    Handler -> QuestionSetService : CanUserEditQuestionSet(userId, questionSetId)
    activate QuestionSetService
    QuestionSetService -> ApplicationDbContext : Query Permission
    activate ApplicationDbContext
    ApplicationDbContext -> Database : Query Permission
    activate Database
    Database --> ApplicationDbContext : Permission
    deactivate Database
    ApplicationDbContext --> QuestionSetService : Permission
    deactivate ApplicationDbContext
    QuestionSetService --> Handler : bool
    deactivate QuestionSetService
    alt User Not Have Access
        Handler --> QuestionSetEndpoints : Error: USER_NOT_ACCESS_TO_QUESTION_SET
        QuestionSetEndpoints --> UI : 400 Bad Request (errorCode: USER_NOT_ACCESS_TO_QUESTION_SET)
        UI -> User : Error: User does not have access to question set
    else User Has Access
        Handler -> ApplicationDbContext : Query QuestionSetUsers by QuestionSetId
        activate ApplicationDbContext
        ApplicationDbContext -> Database : Query QuestionSetUsers
        activate Database
        Database --> ApplicationDbContext : List<QuestionSetUser>
        deactivate Database
        ApplicationDbContext --> Handler : List<QuestionSetUser>
        deactivate ApplicationDbContext
        Handler -> Handler : Map to SharingModelDto and Sort
        Handler --> QuestionSetEndpoints : ResourceShareDto
        QuestionSetEndpoints --> UI : 200 OK (ApiResponse<ResourceShareDto>)
        UI -> User : Show sharing details
    end
end
deactivate Handler
deactivate QuestionSetEndpoints
deactivate UI
@enduml