create table "__EFMigrationsHistory"
(
    "MigrationId"    varchar(150) not null
        constraint "PK___EFMigrationsHistory"
            primary key,
    "ProductVersion" varchar(32)  not null
);

alter table "__EFMigrationsHistory"
    owner to sa;

create table "AspNetRoles"
(
    "Id"               uuid not null
        constraint "PK_AspNetRoles"
            primary key,
    "Name"             varchar(256),
    "NormalizedName"   varchar(256),
    "ConcurrencyStamp" text
);

alter table "AspNetRoles"
    owner to sa;

create unique index "RoleNameIndex"
    on "AspNetRoles" ("NormalizedName");

create table "AspNetUsers"
(
    "Id"                                 uuid                  not null
        constraint "PK_AspNetUsers"
            primary key,
    "IsDeleted"                          boolean default false not null,
    "IsBanned"                           boolean               not null,
    "UserName"                           varchar(256),
    "NormalizedUserName"                 varchar(256),
    "Email"                              varchar(256),
    "NormalizedEmail"                    varchar(256),
    "EmailConfirmed"                     boolean               not null,
    "PasswordHash"                       text,
    "SecurityStamp"                      text,
    "ConcurrencyStamp"                   text,
    "PhoneNumber"                        text,
    "PhoneNumberConfirmed"               boolean               not null,
    "TwoFactorEnabled"                   boolean               not null,
    "LockoutEnd"                         timestamp with time zone,
    "LockoutEnabled"                     boolean               not null,
    "AccessFailedCount"                  integer               not null,
    "EmailVerificationCode"              varchar(10),
    "PasswordResetRequestLockoutEnd"     timestamp with time zone,
    "FailedPasswordResetAttempts"        integer default 0     not null,
    "PasswordResetCode"                  varchar(10),
    "PasswordResetCodeExpiryTime"        timestamp with time zone,
    "PasswordResetRequestAttempts"       integer default 0     not null,
    "EmailRequestLockout"                integer default 0     not null,
    "EmailRequestLockoutTime"            timestamp with time zone,
    "EmailVerificationCodeExpiryTime"    timestamp with time zone,
    "EmailVerificationLockoutEnd"        timestamp with time zone,
    "EmailVerificationRequestAttempts"   integer default 0     not null,
    "EmailVerificationRequestLockoutEnd" timestamp with time zone,
    "FailedEmailVerificationAttempts"    integer default 0     not null,
    "PasswordResetLockoutEnd"            timestamp with time zone
);

alter table "AspNetUsers"
    owner to sa;

create index "EmailIndex"
    on "AspNetUsers" ("NormalizedEmail");

create unique index "UserNameIndex"
    on "AspNetUsers" ("NormalizedUserName");

create table "Tags"
(
    "Id"               uuid              not null
        constraint "PK_Tags"
            primary key,
    "Name"             varchar(500)      not null,
    "QuestionSetCount" integer default 0 not null
);

alter table "Tags"
    owner to sa;

create table "AspNetRoleClaims"
(
    "Id"         integer generated by default as identity
        constraint "PK_AspNetRoleClaims"
            primary key,
    "RoleId"     uuid not null
        constraint "FK_AspNetRoleClaims_AspNetRoles_RoleId"
            references "AspNetRoles"
            on delete cascade,
    "ClaimType"  text,
    "ClaimValue" text
);

alter table "AspNetRoleClaims"
    owner to sa;

create index "IX_AspNetRoleClaims_RoleId"
    on "AspNetRoleClaims" ("RoleId");

create table "AspNetUserClaims"
(
    "Id"         integer generated by default as identity
        constraint "PK_AspNetUserClaims"
            primary key,
    "UserId"     uuid not null
        constraint "FK_AspNetUserClaims_AspNetUsers_UserId"
            references "AspNetUsers"
            on delete cascade,
    "ClaimType"  text,
    "ClaimValue" text
);

alter table "AspNetUserClaims"
    owner to sa;

create index "IX_AspNetUserClaims_UserId"
    on "AspNetUserClaims" ("UserId");

create table "AspNetUserLogins"
(
    "LoginProvider"       text not null,
    "ProviderKey"         text not null,
    "ProviderDisplayName" text,
    "UserId"              uuid not null
        constraint "FK_AspNetUserLogins_AspNetUsers_UserId"
            references "AspNetUsers"
            on delete cascade,
    constraint "PK_AspNetUserLogins"
        primary key ("LoginProvider", "ProviderKey")
);

alter table "AspNetUserLogins"
    owner to sa;

create index "IX_AspNetUserLogins_UserId"
    on "AspNetUserLogins" ("UserId");

create table "AspNetUserRoles"
(
    "UserId" uuid not null
        constraint "FK_AspNetUserRoles_AspNetUsers_UserId"
            references "AspNetUsers"
            on delete cascade,
    "RoleId" uuid not null
        constraint "FK_AspNetUserRoles_AspNetRoles_RoleId"
            references "AspNetRoles"
            on delete cascade,
    constraint "PK_AspNetUserRoles"
        primary key ("UserId", "RoleId")
);

alter table "AspNetUserRoles"
    owner to sa;

create index "IX_AspNetUserRoles_RoleId"
    on "AspNetUserRoles" ("RoleId");

create table "AspNetUserTokens"
(
    "UserId"        uuid not null
        constraint "FK_AspNetUserTokens_AspNetUsers_UserId"
            references "AspNetUsers"
            on delete cascade,
    "LoginProvider" text not null,
    "Name"          text not null,
    "Value"         text,
    constraint "PK_AspNetUserTokens"
        primary key ("UserId", "LoginProvider", "Name")
);

alter table "AspNetUserTokens"
    owner to sa;

create table "DomainUsers"
(
    "Id"              uuid                                                                   not null
        constraint "PK_DomainUsers"
            primary key
        constraint "FK_DomainUsers_AspNetUsers_Id"
            references "AspNetUsers"
            on delete restrict,
    "FullName"        varchar(500),
    "Email"           varchar(500)                                                           not null,
    "IsDeleted"       boolean                  default false                                 not null,
    "IsBanned"        boolean                  default false                                 not null,
    "TokenCount"      bigint                   default 0                                     not null,
    "Balance"         bigint                                                                 not null,
    "PaymentCode"     varchar(100),
    "IsPaymentLocked" boolean                  default false                                 not null,
    "Created"         timestamp with time zone default '-infinity'::timestamp with time zone not null
);

alter table "DomainUsers"
    owner to sa;

create table "Classes"
(
    "Id"             uuid                     not null
        constraint "PK_Classes"
            primary key,
    "Name"           varchar(100)             not null,
    "IsDeleted"      boolean                  not null,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_Classes_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid,
    "Topic"          text
);

alter table "Classes"
    owner to sa;

create index "IX_Classes_CreatedBy"
    on "Classes" ("CreatedBy");

create table "Folders"
(
    "Id"             uuid                     not null
        constraint "PK_Folders"
            primary key,
    "Name"           varchar(100)             not null,
    "IsDeleted"      boolean                  not null,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_Folders_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid
);

alter table "Folders"
    owner to sa;

create index "IX_Folders_CreatedBy"
    on "Folders" ("CreatedBy");

create table "Plans"
(
    "Id"                         uuid                     not null
        constraint "PK_Plans"
            primary key,
    "Name"                       varchar(100)             not null,
    "Price"                      numeric(18, 2)           not null,
    "Duration"                   integer                  not null,
    "CanLearn"                   boolean                  not null,
    "CanOpenTest"                boolean                  not null,
    "CanCopyOrImportQuestionSet" boolean                  not null,
    "IsDeleted"                  boolean default false    not null,
    "Created"                    timestamp with time zone not null,
    "CreatedBy"                  uuid
        constraint "FK_Plans_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"               timestamp with time zone not null,
    "LastModifiedBy"             uuid,
    "IsActive"                   boolean default false    not null,
    "Unit"                       text    default ''::text not null
);

alter table "Plans"
    owner to sa;

create index "IX_Plans_CreatedBy"
    on "Plans" ("CreatedBy");

create table "QuestionSets"
(
    "Id"             uuid                         not null
        constraint "PK_QuestionSets"
            primary key,
    "Name"           varchar(100)                 not null,
    "Description"    varchar(500),
    "VisibilityMode" text                         not null,
    "QuestionCount"  integer          default 0   not null,
    "IsDeleted"      boolean                      not null,
    "Created"        timestamp with time zone     not null,
    "CreatedBy"      uuid
        constraint "FK_QuestionSets_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone     not null,
    "LastModifiedBy" uuid,
    "RatingAverage"  double precision default 0.0 not null,
    "RatingCount"    integer          default 0   not null,
    "RatingSum"      integer          default 0   not null
);

alter table "QuestionSets"
    owner to sa;

create index "IX_QuestionSets_CreatedBy"
    on "QuestionSets" ("CreatedBy");

create table "TestTemplates"
(
    "Id"             uuid                     not null
        constraint "PK_TestTemplates"
            primary key,
    "Name"           varchar(100)             not null,
    "IsDeleted"      boolean                  not null,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_TestTemplates_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid,
    "Description"    text
);

alter table "TestTemplates"
    owner to sa;

create index "IX_TestTemplates_CreatedBy"
    on "TestTemplates" ("CreatedBy");

create unique index "IX_DomainUsers_PaymentCode"
    on "DomainUsers" ("PaymentCode");

create table "RefreshTokens"
(
    "Id"            varchar(36)              not null
        constraint "PK_RefreshTokens"
            primary key,
    "UserAccountId" uuid                     not null
        constraint "FK_RefreshTokens_AspNetUsers_UserAccountId"
            references "AspNetUsers"
            on delete cascade,
    "Token"         varchar(500)             not null,
    "ExpireAt"      timestamp with time zone not null
);

alter table "RefreshTokens"
    owner to sa;

create index "IX_RefreshTokens_UserAccountId"
    on "RefreshTokens" ("UserAccountId");

create table "ClassInvitations"
(
    "Id"             uuid                     not null
        constraint "PK_ClassInvitations"
            primary key,
    "ClassId"        uuid                     not null
        constraint "FK_ClassInvitations_Classes_ClassId"
            references "Classes"
            on delete cascade,
    "Code"           varchar(50)              not null,
    "TimeStart"      timestamp with time zone not null,
    "TimeEnd"        timestamp with time zone not null,
    "IsDeleted"      boolean default false    not null,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_ClassInvitations_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid
);

alter table "ClassInvitations"
    owner to sa;

create index "IX_ClassInvitations_ClassId"
    on "ClassInvitations" ("ClassId");

create index "IX_ClassInvitations_CreatedBy"
    on "ClassInvitations" ("CreatedBy");

create table "Tests"
(
    "Id"                          uuid                        not null
        constraint "PK_Tests"
            primary key,
    "Name"                        varchar(100)                not null,
    "ClassId"                     uuid                        not null
        constraint "FK_Tests_Classes_ClassId"
            references "Classes"
            on delete restrict,
    "TimeStart"                   timestamp with time zone    not null,
    "TimeFinish"                  timestamp with time zone    not null,
    "TimeLimit"                   integer                     not null,
    "QuestionCount"               integer                     not null,
    "GradeAttemptMethod"          text                        not null,
    "GradeQuestionMethod"         text                        not null,
    "IsShowCorrectAnswerInReview" boolean       default false not null,
    "Created"                     timestamp with time zone    not null,
    "CreatedBy"                   uuid
        constraint "FK_Tests_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"                timestamp with time zone    not null,
    "LastModifiedBy"              uuid,
    "PassingScore"                numeric(5, 2) default 0.0   not null,
    "MaxAttempt"                  integer       default 0     not null,
    "IsAllowReviewAfterSubmit"    boolean       default false not null,
    "IsDeleted"                   boolean       default false not null
);

alter table "Tests"
    owner to sa;

create index "IX_Tests_ClassId"
    on "Tests" ("ClassId");

create index "IX_Tests_CreatedBy"
    on "Tests" ("CreatedBy");

create table "ClassQuestionSets"
(
    "ClassId"        uuid                     not null
        constraint "FK_ClassQuestionSets_Classes_ClassId"
            references "Classes"
            on delete cascade,
    "QuestionSetId"  uuid                     not null
        constraint "FK_ClassQuestionSets_QuestionSets_QuestionSetId"
            references "QuestionSets"
            on delete restrict,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_ClassQuestionSets_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid,
    constraint "PK_ClassQuestionSets"
        primary key ("ClassId", "QuestionSetId")
);

alter table "ClassQuestionSets"
    owner to sa;

create index "IX_ClassQuestionSets_QuestionSetId"
    on "ClassQuestionSets" ("QuestionSetId");

create index "IX_ClassQuestionSets_CreatedBy"
    on "ClassQuestionSets" ("CreatedBy");

create table "Questions"
(
    "Id"             uuid                        not null
        constraint "PK_Questions"
            primary key,
    "QuestionSetId"  uuid
        constraint "FK_Questions_QuestionSets_QuestionSetId"
            references "QuestionSets"
            on delete cascade,
    "Type"           text                        not null,
    "QuestionText"   varchar(1000),
    "TextFormat"     text                        not null,
    "ExplainText"    varchar(1000),
    "Score"          numeric(5, 2) default 0.0   not null,
    "DataJson"       json                        not null,
    "Created"        timestamp with time zone    not null,
    "CreatedBy"      uuid
        constraint "FK_Questions_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone    not null,
    "LastModifiedBy" uuid,
    "IsDeleted"      boolean       default false not null
);

alter table "Questions"
    owner to sa;

create index "IX_Questions_QuestionSetId"
    on "Questions" ("QuestionSetId");

create index "IX_Questions_CreatedBy"
    on "Questions" ("CreatedBy");

create table "QuestionSetTags"
(
    "TagId"         uuid not null
        constraint "FK_QuestionSetTags_Tags_TagId"
            references "Tags"
            on delete cascade,
    "QuestionSetId" uuid not null
        constraint "FK_QuestionSetTags_QuestionSets_QuestionSetId"
            references "QuestionSets"
            on delete cascade,
    constraint "PK_QuestionSetTags"
        primary key ("TagId", "QuestionSetId")
);

alter table "QuestionSetTags"
    owner to sa;

create index "IX_QuestionSetTags_QuestionSetId"
    on "QuestionSetTags" ("QuestionSetId");

create table "FolderTestTemplates"
(
    "FolderId"       uuid                     not null
        constraint "FK_FolderTestTemplates_Folders_FolderId"
            references "Folders"
            on delete cascade,
    "TestTemplateId" uuid                     not null
        constraint "FK_FolderTestTemplates_TestTemplates_TestTemplateId"
            references "TestTemplates"
            on delete cascade,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_FolderTestTemplates_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid,
    constraint "PK_FolderTestTemplates"
        primary key ("FolderId", "TestTemplateId")
);

alter table "FolderTestTemplates"
    owner to sa;

create index "IX_FolderTestTemplates_TestTemplateId"
    on "FolderTestTemplates" ("TestTemplateId");

create index "IX_FolderTestTemplates_CreatedBy"
    on "FolderTestTemplates" ("CreatedBy");

create table "ClassUsers"
(
    "ClassId"        uuid                     not null
        constraint "FK_ClassUsers_Classes_ClassId"
            references "Classes"
            on delete cascade,
    "UserId"         uuid                     not null
        constraint "FK_ClassUsers_DomainUsers_UserId"
            references "DomainUsers"
            on delete restrict,
    "ShareMode"      text                     not null,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_ClassUsers_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid,
    constraint "PK_ClassUsers"
        primary key ("ClassId", "UserId")
);

alter table "ClassUsers"
    owner to sa;

create index "IX_ClassUsers_UserId"
    on "ClassUsers" ("UserId");

create index "IX_ClassUsers_CreatedBy"
    on "ClassUsers" ("CreatedBy");

create table "FolderUsers"
(
    "UserId"         uuid                     not null
        constraint "FK_FolderUsers_DomainUsers_UserId"
            references "DomainUsers"
            on delete restrict,
    "FolderId"       uuid                     not null
        constraint "FK_FolderUsers_Folders_FolderId"
            references "Folders"
            on delete cascade,
    "ShareMode"      text                     not null,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_FolderUsers_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid,
    "IsViewed"       boolean default false    not null,
    constraint "PK_FolderUsers"
        primary key ("UserId", "FolderId")
);

alter table "FolderUsers"
    owner to sa;

create index "IX_FolderUsers_FolderId"
    on "FolderUsers" ("FolderId");

create index "IX_FolderUsers_CreatedBy"
    on "FolderUsers" ("CreatedBy");

create table "QuestionSetUsers"
(
    "UserId"         uuid                     not null
        constraint "FK_QuestionSetUsers_DomainUsers_UserId"
            references "DomainUsers"
            on delete restrict,
    "QuestionSetId"  uuid                     not null
        constraint "FK_QuestionSetUsers_QuestionSets_QuestionSetId"
            references "QuestionSets"
            on delete cascade,
    "ShareMode"      text                     not null,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_QuestionSetUsers_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid,
    constraint "PK_QuestionSetUsers"
        primary key ("UserId", "QuestionSetId")
);

alter table "QuestionSetUsers"
    owner to sa;

create index "IX_QuestionSetUsers_QuestionSetId"
    on "QuestionSetUsers" ("QuestionSetId");

create index "IX_QuestionSetUsers_CreatedBy"
    on "QuestionSetUsers" ("CreatedBy");

create table "TodoLists"
(
    "Id"             integer generated by default as identity
        constraint "PK_TodoLists"
            primary key,
    "Title"          varchar(200)             not null,
    "Colour_Code"    text                     not null,
    "UserId"         uuid
        constraint "FK_TodoLists_DomainUsers_UserId"
            references "DomainUsers",
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_TodoLists_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid
);

alter table "TodoLists"
    owner to sa;

create index "IX_TodoLists_UserId"
    on "TodoLists" ("UserId");

create index "IX_TodoLists_CreatedBy"
    on "TodoLists" ("CreatedBy");

create table "UserSubscriptions"
(
    "Id"         uuid                     not null
        constraint "PK_UserSubscriptions"
            primary key,
    "UserId"     uuid                     not null
        constraint "FK_UserSubscriptions_DomainUsers_UserId"
            references "DomainUsers"
            on delete restrict,
    "PlanId"     uuid                     not null
        constraint "FK_UserSubscriptions_Plans_PlanId"
            references "Plans"
            on delete restrict,
    "DateStart"  timestamp with time zone not null,
    "DateFinish" timestamp with time zone not null,
    "IsActive"   boolean default false    not null,
    "Duration"   integer default 0        not null,
    "Price"      integer default 0        not null,
    "Unit"       text
);

alter table "UserSubscriptions"
    owner to sa;

create index "IX_UserSubscriptions_PlanId"
    on "UserSubscriptions" ("PlanId");

create index "IX_UserSubscriptions_UserId"
    on "UserSubscriptions" ("UserId");

create table "ClassInvitationUsers"
(
    "Id"                uuid                     not null
        constraint "PK_ClassInvitationUsers"
            primary key,
    "UserId"            uuid                     not null
        constraint "FK_ClassInvitationUsers_DomainUsers_UserId"
            references "DomainUsers"
            on delete restrict,
    "ClassInvitationId" uuid                     not null
        constraint "FK_ClassInvitationUsers_ClassInvitations_ClassInvitationId"
            references "ClassInvitations"
            on delete cascade,
    "TimeJoin"          timestamp with time zone not null
);

alter table "ClassInvitationUsers"
    owner to sa;

create index "IX_ClassInvitationUsers_ClassInvitationId"
    on "ClassInvitationUsers" ("ClassInvitationId");

create index "IX_ClassInvitationUsers_UserId"
    on "ClassInvitationUsers" ("UserId");

create table "TestGrades"
(
    "Id"     uuid          not null
        constraint "PK_TestGrades"
            primary key,
    "TestId" uuid          not null
        constraint "FK_TestGrades_Tests_TestId"
            references "Tests"
            on delete cascade,
    "UserId" uuid          not null
        constraint "FK_TestGrades_DomainUsers_UserId"
            references "DomainUsers"
            on delete cascade,
    "Score"  numeric(5, 2) not null
);

alter table "TestGrades"
    owner to sa;

create index "IX_TestGrades_TestId"
    on "TestGrades" ("TestId");

create index "IX_TestGrades_UserId"
    on "TestGrades" ("UserId");

create table "TestVersions"
(
    "Id"     uuid    not null
        constraint "PK_TestVersions"
            primary key,
    "TestId" uuid    not null
        constraint "FK_TestVersions_Tests_TestId"
            references "Tests"
            on delete cascade,
    "No"     integer not null
);

alter table "TestVersions"
    owner to sa;

create table "Attempts"
(
    "Id"            uuid                     not null
        constraint "PK_Attempts"
            primary key,
    "TestId"        uuid                     not null
        constraint "FK_Attempts_Tests_TestId"
            references "Tests"
            on delete restrict,
    "TestVersionId" uuid                     not null
        constraint "FK_Attempts_TestVersions_TestVersionId"
            references "TestVersions"
            on delete restrict,
    "UserId"        uuid                     not null
        constraint "FK_Attempts_DomainUsers_UserId"
            references "DomainUsers"
            on delete restrict,
    "TimeStart"     timestamp with time zone not null,
    "TimeFinish"    timestamp with time zone not null,
    "Score"         numeric(5, 2)            not null
);

alter table "Attempts"
    owner to sa;

create index "IX_Attempts_TestId"
    on "Attempts" ("TestId");

create index "IX_Attempts_UserId"
    on "Attempts" ("UserId");

create index "IX_Attempts_TestVersionId"
    on "Attempts" ("TestVersionId");

create index "IX_TestVersions_TestId"
    on "TestVersions" ("TestId");

create table "Comments"
(
    "Id"             uuid                     not null
        constraint "PK_Comments"
            primary key,
    "ParentId"       uuid
        constraint "FK_Comments_Comments_ParentId"
            references "Comments"
            on delete restrict,
    "QuestionId"     uuid                     not null
        constraint "FK_Comments_Questions_QuestionId"
            references "Questions"
            on delete cascade,
    "Content"        varchar(1000)            not null,
    "IsDeleted"      boolean default false    not null,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_Comments_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete cascade,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid
);

alter table "Comments"
    owner to sa;

create index "IX_Comments_ParentId"
    on "Comments" ("ParentId");

create index "IX_Comments_QuestionId"
    on "Comments" ("QuestionId");

create index "IX_Comments_CreatedBy"
    on "Comments" ("CreatedBy");

create table "TestTemplateQuestions"
(
    "Id"             uuid                     not null
        constraint "PK_TestTemplateQuestions"
            primary key,
    "TestTemplateId" uuid                     not null
        constraint "FK_TestTemplateQuestions_TestTemplates_TestTemplateId"
            references "TestTemplates"
            on delete cascade,
    "QuestionId"     uuid                     not null
        constraint "FK_TestTemplateQuestions_Questions_QuestionId"
            references "Questions"
            on delete restrict,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_TestTemplateQuestions_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid
);

alter table "TestTemplateQuestions"
    owner to sa;

create index "IX_TestTemplateQuestions_QuestionId"
    on "TestTemplateQuestions" ("QuestionId");

create index "IX_TestTemplateQuestions_TestTemplateId"
    on "TestTemplateQuestions" ("TestTemplateId");

create index "IX_TestTemplateQuestions_CreatedBy"
    on "TestTemplateQuestions" ("CreatedBy");

create table "UserQuestionSetHistories"
(
    "UserId"         uuid                     not null
        constraint "FK_UserQuestionSetHistories_DomainUsers_UserId"
            references "DomainUsers"
            on delete restrict,
    "QuestionId"     uuid                     not null
        constraint "FK_UserQuestionSetHistories_Questions_QuestionId"
            references "Questions"
            on delete cascade,
    "IsCorrect"      boolean                  not null,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_UserQuestionSetHistories_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid,
    constraint "PK_UserQuestionSetHistories"
        primary key ("UserId", "QuestionId")
);

alter table "UserQuestionSetHistories"
    owner to sa;

create index "IX_UserQuestionSetHistories_QuestionId"
    on "UserQuestionSetHistories" ("QuestionId");

create index "IX_UserQuestionSetHistories_CreatedBy"
    on "UserQuestionSetHistories" ("CreatedBy");

create table "TodoItems"
(
    "Id"             integer generated by default as identity
        constraint "PK_TodoItems"
            primary key,
    "ListId"         integer                  not null
        constraint "FK_TodoItems_TodoLists_ListId"
            references "TodoLists"
            on delete cascade,
    "Title"          varchar(200)             not null,
    "Note"           text,
    "Priority"       integer                  not null,
    "Reminder"       timestamp with time zone,
    "Done"           boolean                  not null,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_TodoItems_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid
);

alter table "TodoItems"
    owner to sa;

create index "IX_TodoItems_ListId"
    on "TodoItems" ("ListId");

create index "IX_TodoItems_CreatedBy"
    on "TodoItems" ("CreatedBy");

create table "AttemptQuestions"
(
    "Id"         uuid              not null
        constraint "PK_AttemptQuestions"
            primary key,
    "AttemptId"  uuid              not null
        constraint "FK_AttemptQuestions_Attempts_AttemptId"
            references "Attempts"
            on delete cascade,
    "QuestionId" uuid              not null
        constraint "FK_AttemptQuestions_Questions_QuestionId"
            references "Questions"
            on delete restrict,
    "Order"      integer default 0 not null,
    "Score"      numeric(5, 2)     not null,
    "DataJson"   json              not null
);

alter table "AttemptQuestions"
    owner to sa;

create index "IX_AttemptQuestions_AttemptId"
    on "AttemptQuestions" ("AttemptId");

create index "IX_AttemptQuestions_QuestionId"
    on "AttemptQuestions" ("QuestionId");

create table "TestVersionQuestions"
(
    "Id"            uuid    not null
        constraint "PK_TestVersionQuestions"
            primary key,
    "TestVersionId" uuid    not null
        constraint "FK_TestVersionQuestions_TestVersions_TestVersionId"
            references "TestVersions"
            on delete cascade,
    "QuestionId"    uuid    not null
        constraint "FK_TestVersionQuestions_Questions_QuestionId"
            references "Questions"
            on delete restrict,
    "Order"         integer not null
);

alter table "TestVersionQuestions"
    owner to sa;

create index "IX_TestVersionQuestions_QuestionId"
    on "TestVersionQuestions" ("QuestionId");

create index "IX_TestVersionQuestions_TestVersionId"
    on "TestVersionQuestions" ("TestVersionId");

create table "TestTemplateUsers"
(
    "UserId"         uuid                     not null
        constraint "FK_TestTemplateUsers_DomainUsers_UserId"
            references "DomainUsers"
            on delete restrict,
    "TestTemplateId" uuid                     not null
        constraint "FK_TestTemplateUsers_TestTemplates_TestTemplateId"
            references "TestTemplates"
            on delete cascade,
    "ShareMode"      text                     not null,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_TestTemplateUsers_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid,
    "IsViewed"       boolean default false    not null,
    constraint "PK_TestTemplateUsers"
        primary key ("UserId", "TestTemplateId")
);

alter table "TestTemplateUsers"
    owner to sa;

create index "IX_TestTemplateUsers_CreatedBy"
    on "TestTemplateUsers" ("CreatedBy");

create index "IX_TestTemplateUsers_TestTemplateId"
    on "TestTemplateUsers" ("TestTemplateId");

create table "UserQuestionSetAccessHistories"
(
    "UserId"        uuid                     not null
        constraint "FK_UserQuestionSetAccessHistories_DomainUsers_UserId"
            references "DomainUsers"
            on delete restrict,
    "QuestionSetId" uuid                     not null
        constraint "FK_UserQuestionSetAccessHistories_QuestionSets_QuestionSetId"
            references "QuestionSets"
            on delete restrict,
    "LastAccess"    timestamp with time zone not null,
    "IsSaved"       boolean                  not null,
    constraint "PK_UserQuestionSetAccessHistories"
        primary key ("UserId", "QuestionSetId")
);

alter table "UserQuestionSetAccessHistories"
    owner to sa;

create index "IX_UserQuestionSetAccessHistories_QuestionSetId"
    on "UserQuestionSetAccessHistories" ("QuestionSetId");

create table "Transactions"
(
    "Id"              uuid    not null
        constraint "PK_Transactions"
            primary key,
    "UserId"          uuid    not null
        constraint "FK_Transactions_DomainUsers_UserId"
            references "DomainUsers"
            on delete restrict,
    "PaymentId"       text,
    "Code"            varchar(255),
    "Gateway"         text,
    "TransferType"    text,
    "TransferAmount"  numeric not null,
    "TransactionDate" timestamp with time zone,
    "AccountNumber"   text,
    "SubAccount"      text,
    "Accumulated"     numeric,
    "Content"         text,
    "Description"     text,
    "Created"         timestamp with time zone
);

alter table "Transactions"
    owner to sa;

create index "IX_Transactions_UserId"
    on "Transactions" ("UserId");

create unique index "IX_Transactions_PaymentId"
    on "Transactions" ("PaymentId");

create table "PlanPriceHistories"
(
    "Id"             uuid                     not null
        constraint "PK_PlanPriceHistories"
            primary key,
    "PlanId"         uuid                     not null
        constraint "FK_PlanPriceHistories_Plans_PlanId"
            references "Plans"
            on delete restrict,
    "Price"          integer                  not null,
    "DateStart"      timestamp with time zone not null,
    "DateFinish"     timestamp with time zone,
    "Created"        timestamp with time zone not null,
    "CreatedBy"      uuid
        constraint "FK_PlanPriceHistories_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid
);

alter table "PlanPriceHistories"
    owner to sa;

create index "IX_PlanPriceHistories_CreatedBy"
    on "PlanPriceHistories" ("CreatedBy");

create index "IX_PlanPriceHistories_PlanId"
    on "PlanPriceHistories" ("PlanId");

create table "QuestionSetRatings"
(
    "CreatedBy"      uuid                     not null
        constraint "FK_QuestionSetRatings_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "QuestionSetId"  uuid                     not null
        constraint "FK_QuestionSetRatings_QuestionSets_QuestionSetId"
            references "QuestionSets"
            on delete cascade,
    "Rating"         integer                  not null,
    "Created"        timestamp with time zone not null,
    "LastModified"   timestamp with time zone not null,
    "LastModifiedBy" uuid,
    constraint "PK_QuestionSetRatings"
        primary key ("QuestionSetId", "CreatedBy")
);

alter table "QuestionSetRatings"
    owner to sa;

create index "IX_QuestionSetRatings_CreatedBy"
    on "QuestionSetRatings" ("CreatedBy");

create table "SystemSettings"
(
    "Id"                         uuid                     not null
        constraint "PK_SystemSettings"
            primary key,
    "InputCostPerMillionTokens"  integer                  not null,
    "OutputCostPerMillionTokens" integer                  not null,
    "FixedSystemFee"             integer                  not null,
    "MaxInputToken"              integer                  not null,
    "MaxOutputToken"             integer                  not null,
    "Created"                    timestamp with time zone not null,
    "CreatedBy"                  uuid
        constraint "FK_SystemSettings_DomainUsers_CreatedBy"
            references "DomainUsers"
            on delete restrict,
    "LastModified"               timestamp with time zone not null,
    "LastModifiedBy"             uuid
);

alter table "SystemSettings"
    owner to sa;

create index "IX_SystemSettings_CreatedBy"
    on "SystemSettings" ("CreatedBy");

