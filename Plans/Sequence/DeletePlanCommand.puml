@startuml
actor AdminUser
participant "Plan Management UI" as UI
participant PlanEndpoints
participant DeletePlanCommandHandler as Handler
participant ApplicationDbContext
participant Database

AdminUser -> UI : Select plan, click "Delete"
UI -> PlanEndpoints : DELETE /api/Plan/{PlanId}
PlanEndpoints -> Handler : Handle(DeletePlanCommand)
Handler -> ApplicationDbContext : Query Plan by PlanId
ApplicationDbContext -> Database : Query Plan
Database --> ApplicationDbContext : Plan
ApplicationDbContext --> Handler : Plan
alt Plan Not Found
    Handler --> PlanEndpoints : Error: PLAN_NOT_FOUND
    PlanEndpoints --> UI : 400 Bad Request (errorCode: PLAN_NOT_FOUND)
    UI -> AdminUser : Error: Plan not found
else Plan Found
    Handler -> ApplicationDbContext : Mark Plan as Deleted
    ApplicationDbContext -> Database : Update Plan (IsDeleted = true)
    Database --> ApplicationDbContext : Success
    ApplicationDbContext --> Handler : Guid
    Handler --> PlanEndpoints : Guid
    PlanEndpoints --> UI : 200 OK (ApiResponse<Guid>)
    UI -> AdminUser : Info: Plan deleted successfully
end
@enduml