@startuml
actor User
participant UI
participant AuthenticationEndpoints
participant LoginHandler
participant IdentityService
participant UserManager
participant Database

User -> UI : Enter email, password
UI -> AuthenticationEndpoints : POST /api/Authentication/Login
AuthenticationEndpoints -> LoginHandler : Send LoginCommand
LoginHandler -> IdentityService : TryLoginAsync(email, password)
IdentityService -> UserManager : FindByEmailAsync(email)
UserManager -> Database : Query UserAccount
Database --> UserManager : UserAccount/null
alt User not found
    IdentityService --> LoginHandler : Error: ACCOUNT_INVALID_CREDENTIALS
    LoginHandler --> AuthenticationEndpoints : Error (ACCOUNT_INVALID_CREDENTIALS)
    AuthenticationEndpoints --> UI : 400 Bad Request (ACCOUNT_INVALID_CREDENTIALS)
    UI -> User : Thông báo lỗi: Sai tài khoản hoặc mật khẩu
else User found
    IdentityService -> UserManager : CheckPasswordSignInAsync(user, password)
    UserManager -> Database : Verify password
    Database --> UserManager : Result
    alt Password correct
        IdentityService --> LoginHandler : TokenDto
        LoginHandler --> AuthenticationEndpoints : TokenDto
        AuthenticationEndpoints --> UI : 200 OK + Tokens
        UI -> User : Đăng nhập thành công, chuyển trang
    else Password incorrect
        IdentityService --> LoginHandler : Error: ACCOUNT_INVALID_CREDENTIALS
        LoginHandler --> AuthenticationEndpoints : Error (ACCOUNT_INVALID_CREDENTIALS)
        AuthenticationEndpoints --> UI : 400 Bad Request (ACCOUNT_INVALID_CREDENTIALS)
        UI -> User : Thông báo lỗi: Sai tài khoản hoặc mật khẩu
    end
end
@enduml