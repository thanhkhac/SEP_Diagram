@startuml
actor Client
participant ":TodoItemsEndpoint" as Endpoint
participant ":Mediator" as Mediator
participant ":CreateTodoItemCommandHandler" as Handler
participant ":TodoItem" as Entity
participant ":ApplicationDbContext" as DbContext

title Sequence Diagram: Create TodoItem (Clean Architecture)

' Client gửi yêu cầu POST với JSON
Client -> Endpoint: POST /todoitems {JSON: title, note}
note right: JSON payload\n{\n  "title": "Buy groceries",\n  "note": "Milk, eggs"\n}
activate Endpoint

' Endpoint gửi command qua Mediator
Endpoint -> Mediator: Send(CreateTodoItemCommand)
note left: Mediator Pattern (MediatR):\nDispatch to command handler
activate Mediator

' Mediator gọi Command Handler
Mediator -> Handler: Handle(CreateTodoItemCommand)
note right: Application Layer:\nContains business logic
activate Handler

' Handler tạo Entity
Handler -> Entity: new TodoItem(title, note)
note right: Domain Layer:\nBusiness rules validation
activate Entity
Entity --> Handler: TodoItem instance
deactivate Entity

' Handler lưu vào database qua DbContext
Handler -> DbContext: Add(TodoItem)
note right: Infrastructure Layer:\nPersists data to database
activate DbContext
DbContext --> Handler: Success
deactivate DbContext

' Kết quả trả về qua các layer
Handler --> Mediator: Result
deactivate Handler
Mediator --> Endpoint: Result
deactivate Mediator
Endpoint --> Client: 200 OK {JSON: todoItemId, title}
note right: JSON response\n{\n  "id": 1,\n  "title": "Buy groceries"\n}
deactivate Endpoint

@enduml